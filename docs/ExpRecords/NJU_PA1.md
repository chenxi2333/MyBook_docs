# 南京大学 PA1 实验笔记

1. 如何学习？做PA的终极目标是通过构建一个简单完整的计算机系统, 来深入理解程序如何在计算机上运行. 和那些"用递归实现汉诺塔"的程序设计作业不同, 计算机系统比汉诺塔要复杂得多. 这意味着, 通过程序设计作业的训练方式是不足以完成PA的, 只有去尝试理解并掌握计算机系统的每一处细节, 才能一步步完成PA.
2. 正确的做法是:

   - 多思考为什么
     - 从问题开始着手理解系统也是个不错的方法
   - 独立解决问题
     - 即使是调一个很弱智的bug, "顺带"能学到的东西也比你想象中多得多
     - 换句话说, 如果你选择抱大腿, 你失去的机会也比你想象中多得多
   - 尝试尽可能理解每一处细节
     - 将来调bug的时候, 这些细节就是你手中强有力的工具
     - 换句话说, 当你在调bug的时候感到无从下手, 一定是你不了解其中的细节
   - 用正确的工具做事情
     - 这才是节省时间的科学方法, 而不是偷懒
   - 多读讲义, 彩蛋很多
     - 讲义中特地设置了不少"不合时宜"的提示, 有的彩蛋要多次阅读才能明白其中的奥妙
     - 多看一道蓝框题, 也许能少调几天bug
   - 按时完成, 拒绝拖延
     - 这样你才有时间做到上面几点
3. PA的目的是要实现NEMU, 一款经过简化的全系统模拟器. 但什么是模拟器呢?它模拟了一个硬件的世界, 你可以在这个硬件世界中执行程序. 换句话说, 你将要在PA中编写一个用来执行其它程序的程序。
4.  指令集架构ISA：不同架构的计算机(或者说硬件)好比不同尺寸的螺钉, 不同架构的程序(或者说软件)就相当于是不同尺寸的螺母, 如果一个程序要在特定架构的计算机上运行, 那么这个程序和计算机就必须是符合同一套规范才行。ISA就是这样的规范。常见的有x86 arm mips32 riscv32(64)。软硬件的生产都必须遵守ISA的规范手册，才能够正确的运行。
5.  PA的目的是要实现NEMU, 一款经过简化的全系统模拟器. 但什么是模拟器呢?它模拟了一个硬件的世界, 你可以在这个硬件世界中执行程序. 换句话说, 你将要在PA中编写一个用来执行其它程序的程序。
6. 指令集架构ISA：不同架构的计算机(或者说硬件)好比不同尺寸的螺钉, 不同架构的程序(或者说软件)就相当于是不同尺寸的螺母, 如果一个程序要在特定架构的计算机上运行, 那么这个程序和计算机就必须是符合同一套规范才行。ISA就是这样的规范。常见的有x86 arm mips32 riscv32(64)。软硬件的生产都必须遵守ISA的规范手册，才能够正确的运行。

## 开天辟地的篇章

1. 编程模型是指：对于编程共性的抽象。

2. 最简单的计算机遵从这样的流程：从PC取出指令、执行、更新PC指针位置。这也是图灵对于计算机的最初构想，把指令作为一种数据去存储。

3. 这两个步骤的完成交给了存储器和CPU，存储器中包括了速度慢容量大的存储以及速度很快的寄存器。CPU的主要任务包括了运算以及控制。

4. 计算机可以看作是一个状态机，每一位的状态决定了处在和中状态。而程序就是决定计算机如何在这些状态中切换的。
   
   给定一个程序, 把它放到计算机的内存中, 就相当于在状态数量为`N`的状态转移图中指定了一个初始状态, 程序运行的过程就是从这个初始状态开始, 每执行完一条指令, 就会进行一次确定的状态转移. 也就是说, 程序也可以看成一个状态机。
   
   程序状态机是“计算机”大状态机的子集。
   
   - 如何看待这两种“状态机”？
     
     - 前者是静态的当我们写好程序的时候，计算机的状态机已经确定；而后者则是动态的，描述了状态转移。

## RTFSC

1. Monitor(监视器)模块是为了方便地监控客户计算机的运行状态而引入的. 它除了负责与GNU/Linux进行交互(例如读入客户程序)之外, 还带有调试器的功能, 为NEMU的调试提供了方便的途径. 从概念上来说, monitor并不属于一个计算机的必要组成部分, 但对NEMU来说, 它是必要的基础设施. 如果缺少monitor模块, 对NEMU的调试将会变得十分困难。
2. 值得一提的是，例程中分离出了ISA，这样的抽象设计可以在同一套基本框架下使用不同的ISA。
3. init_monitor:
   
   1. isa_init:
      
      - 第一项工作就是将一个内置的客户程序读入到内存中.
      
      - 第二项任务是初始化寄存器, 这是通过`restart()`函数来实现的——把指针放到内存0的位置上去。
4. GDB中, 我们可以通过单步执行的方式让程序一次执行一条指令, 相当于让状态机一次只前进一步, 这样我们就可以观察程序任意时刻的状态了! 而且状态机前进的轨迹就是程序执行的真实顺序, 于是你就可以一边运行程序一边理解程序的行为了. 这对于一些指针相关的代码有着不错的效果, 尤其是函数指针, 因为你从静态代码上很可能看不出来程序运行的时候这个指针会指向哪个函数。

## 基础设施
1. 基础设施是那些支撑项目开发的各种工具和手段。
	- 对于一个有一定规模的项目而言，好的基础设施能够事半功倍。成倍的提升开发效率。
2. 表达式求值
	- 识别token，也就是各种数字和运算符号
	- 递归求值
3. KISS法则:Keep it Simple , Stupid
	- 程序没必要在一开始就追求完美。
4.  监视点:
## GDB简洁Tutorial

1. 什么是GDB？
   
   1. 一个命令行界面式的代码调试工具。
   2. gdb命令可以进入调试界面。
2. 常用的操作和命令
   1. 断点:break *func +line
   2. 运行run，单步调试step next，next会进入函数
   3. 变量操作print set watch+continue。可以查看程序变量的值。
3. GDB中, 我们可以通过单步执行的方式让程序一次执行一条指令, 相当于让状态机一次只前进一步, 这样我们就可以观察程序任意时刻的状态了! 而且状态机前进的轨迹就是程序执行的真实顺序, 于是你就可以一边运行程序一边理解程序的行为了. 这对于一些指针相关的代码有着不错的效果, 尤其是函数指针, 因为你从静态代码上很可能看不出来程序运行的时候这个指针会指向哪个函数。

## 如何阅读手册？
1. 学会使用目录
	- 可以使用目录来确定想要寻求的问题所在位置
2. 逐步细化搜索范围
2. 
