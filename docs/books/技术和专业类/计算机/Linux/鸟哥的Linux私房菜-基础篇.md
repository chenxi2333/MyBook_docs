# 鸟哥的Linux私房菜-基础篇





# Linux基础

## 什么是Linux？

 Linux 就是一套操作系统。

Linux系统有狭义和广义两种定义。狭义来说，Linux实际上指Linux 内核（kernel）。广义来说，Linux是指以内核为基础的，包括了各种应 用软件在内的Linux发行版（Distribution）。

### 诞生的历史

1. 1973 年：Unix 的正式诞生，Ritchie 等人以 C 语言写出第一个正式 Unix 核心
   * Unix的移植特性来源于C语言的高级语言特性

2. 1984 年之一：x86 架构的 Minix 操作系统开始撰写并于两年后诞生
3. 1984 年之二：GNU 计划与 FSF 基—金会的成
   * 自由软件环境的诞生
   * 1984 年，史托曼开始 GNU 计划，这个计划的目的是：建立一个自由、开放的 Unix 操作系统(Free  Unix)
4. 1988 年：图形接口 XFree86 计划
5. 1991 年：芬兰大学生 Linus Torvalds 的一则简讯——Linux的雏形诞生。
   * Linux的后期完善是通过开源的环境，由广大的黑客完善驱动和软件，逐渐形成的

###  Linux distributions

Linux 是一个操作系统最底层的核心及其提供的核心工具。

为了让所有的 Linux distributions 开发不致于差异太大，且让开发商在开发的时候有所依 据，还有 Linux Standard Base (LSB)等标准来规范开发者，以及目录架构的 File system Hierarchy  Standard (FHS)标准规范。

distributions 主要分为两大系统，一种是使用 RPM 方式安装软件的系统，包括 Red Hat,  Fedora, SuSE 等都是这类； 一种则是使用 Debian 的 dpkg 方式安装软件的系统，包括 Debian, Ubuntu,  B2D 等等。

### Linux的应用场景

1. 网络服务器： 这是 Linux 当前最热门的应用。承袭了 Unix 高稳定性的良好传统，Linux 上面的网络功能特别的稳 定与强大；
2. 关键任务的应用(金融数据库、大型企业网管环境)；
3. 学术机构的高效能运算任务
4. 个人主机：主要就是手机、嵌入式系统
5. 云程序：底层用的是Linux架构的服务器

### Linux 的学习路线

1. 安装与指令
2. 基础技能
3. vim文书编辑器
4. Shell/Shell Script学习
5. 软件管理员
6. 网络基础、网站架设

在实战中学习是最有效的方法

## Linux的用户

- root是管理员账号。在命令行中使用 `$ su -`命令就可以切换到管理员账号。

# 主机规划和磁盘划分

## Linux的硬件

结论：根据需求选择，Linux对硬件的要求很低，小环境下要求更低。

在 Linux 系统中，每个装置都被当成一个文件来对待。这也代表了每个硬件装置会被当做一个文件来对待。

硬件装置文件都在/dev的目录内，

硬盘：/dev/sd[a-d]，一般硬盘的第一个扇区会记录整颗磁盘的重要信息——分区的信息会记录在每个分区槽最前面的几个扇区（这几个扇区无法被格式化）。

**为什么要分区？**

1. 数据的安全性
2. 系统的效能考虑

- 主要分区和逻辑分区：主要分区是借助分区表进行的第一次磁盘分区；逻辑分区是在最后一个分区上进行再次分区。

- 挂载：目录和磁盘挂钩，某个目录下的文件将会全部储存在一个磁盘中。

**开机流程中的BIOS和UFEI开机检测程序 **

BIOS是写入主板的韧体，是计算机会执行的“第一个”程序。

UEFI是C语言编写的更加容易开发的BIOS，也因此支持多平台，有图形化能力。

## 目录树

`/`是根目录，`挂载`就是利用一个目录当成进入点，将磁盘分区槽的数据放置在该目录下。

`~`是home目录，`cd ~`可以直接回到home目录。

文件和文件组织构成了一个文件系统（File System）。Linux的文 件系统是一个树状结构，整个文件系统有个共同的起点，就是树状结构 的顶端，如图15-1所示。Linux把这个起点称为根目录（Root Directory），用符号/表示。

目录本身也是一种 特殊的文件，而/home/pi/doc是指向目录文件doc的绝对路径。

### 软/硬链接

简单来说，硬链接是一个“指向文件的指针”，它所代表的就是文件本身，指向了文件的inode（在磁盘分区头部中存放文件磁盘中地址、文件属性等重要信息的地方）。

软链接就是快捷方式，它所表示的，仅仅是一个文件的目录地址。

当目录文件中增加一个文件的条目时，就建立一个指向文件的硬链 接（Hard Link）。一旦有了对应于文件的硬链接，这个文件就纳入了文 件系统中。一个文件允许出现在多个目录中，这样，它就有多个硬链接。文件拥有的硬链接数目，称为文件在整个系统的链接数（Link Count）。当文件的链接数降为0时，说明文件已经孤立于文件系统之 外。这样的文件会被Linux删除。`unlink`效果等同于删除文件。

同一文件的多个硬链接，会破坏树状的文件系统。因此，Linux系 统并不鼓励手动创建硬链接。在必要的情况下，你可以用软链接（Soft Link）的方式，在多个目录下创建指向同一文件的链接。

软链接不影响文件的链接数。软链接本质上是一个文件，它的文件 类型是symbolic link。在这个文件中，包含有链接指向的文件的绝对路 径。当读写该文件时，Linux会根据软链接中的绝对路径把读写操作导 向软链接所指向的文件。与Windows系统的"快捷方式"类似，Linux的软 链接就是Linux的"快捷方式"。





# Shell命令行

## 什么是命令行？

#### Shell是UNIX系统提供的文本交互界面

Shell（中文意思是“壳”），是一个应用程序，作用是和用户进行“沟通”。

在CentOS7中，【Ctrl+Alt+F1-F6】可以切换出命令行的窗口，F1是图形化界面。

有了命令名，Shell下一步就要执行该命令名对应的动作。这听起来 就像是在戏剧舞台上，演员按照脚本演戏。Shell命令可以分为如下三类。 

* Shell 内建函数（built-in function）；

* 可执行文件（executable file）；

* 别名（alias）。

Shell的内建函数是保存在Shell内部的脚本。相对应地，可执行文件 是保存在Shell之外的脚本。Shell必须在系统中找到对应命令名的可执行 文件，才能正确执行。别名就是给某个命令起的一个简称，以后在Shell中就可以通过这个 简称来调用对应的命令。在Shell中，我们可以用alias命令来定义别名。

Shell是文本解释器程序的统称，所以包括了不止一种Shell。常见的 Shell有sh、bash、ksh、rsh、csh等。在树莓派中，就安装了sh和bash两 个Shell解释器。

#### 命令行的参数和选项

总的来说， 选项用于控制命令的行为，而参数说明了命令的作用对象。

我们不妨把每个命令看作多功能的瑞士军刀，而选项使命 令可以在不同的功能间切换。

####  如何了解一个陌生的命令

1. 文档
2. 命令——包括`whatis,man（查询可用的命令）,info`
   1. `command --help`获取帮助。
   2. `man command` 查看命令（除了命令，只要是具备手册的东西都能够通过这个命令来查看）的手册，这个手册存放在命令相关的文件中。手册中包含了命令的类型、使用方法。


#### 小窍门

1. 快捷键
   1. 【Tab】命令行补齐、文件名补齐（按一次补全，连续两次能够显示所有的可用命令）
   2. 【Shift+PageUp\PageDown】翻页查看之前的命令行内容
   3. 【Ctrl+C】中断进程
   4. 【Ctrl+D】输入中止，结束符号。`

2. 输出重定向：

​	命令 `> target`命令作用写入到特定的文件

​	命令`>> target`以追加的方式写入

3. 管道：将一个程序的输出作为另一个程序的输入`ls -- help|more`|符号

## 文件操作

Tips：M-时Alt键，^时Ctrl键。文件操作可以配合着正则匹配使用

- ls（英文全拼：list files）: 列出目录及文件名
- touch   新建文件
- find   命令会递归地遍历文件系统，搜选出符合条件的文件。
- cd（英文全拼：change directory）：切换目录
- pwd（英文全拼：print work directory）：显示目前的目录
- mkdir（英文全拼：make directory）：创建一个新的目录
- rmdir（英文全拼：remove directory）：删除一个空的目录
- cp（英文全拼：copy file）: 复制文件或目录
- rm（英文全拼：remove）: 删除文件或目录
- mv（英文全拼：move file）: 移动文件与目录，或修改文件与目录的名称

## 软件的安装与升级

我们说托瓦兹是"Linux之父"，是因为他编写并维护着Linux最核心 的程序，即Linux内核。除了内核，Linux还需要很多应用程序，比如sh 和bash。Linux内核加上应用程序，就构成了一个Linux发行版本。因 此，就有不同发行版本的Linux，如Debian、Red Hat、Ubuntu、 Raspbian。此外，除了预装的应用程序，用户还需在使用过程中增加新 的应用程序。用户可以直接在网上下载程序的源代码，然后自行编译成 软件。但编译软件需要很多配置，不同软件之间又有依赖关系，所以普 通用户很容易犯错。 

为了解决这个问题，Linux发行版本都有软件分发机制。你可以从 互联网的软件服务器上找到自己需要的软件并下载安装。这些软件服务 器被称为软件源。软件源提供的软件是已经编译好的。如果这些软件依 赖于其他的软件，分发系统也会帮助你自动下载。

`sudo apt-get`+`update/upgrade/install/remove/purge <name>`

下载特别慢的话可以修改为国内的镜像源



# 基础文件编程

Linux中一切皆文件，因此一切都可以修改。

## gcc编译器

1. 一步到位：gcc hello.c 默认生成a.out（-o hello可以生成对应的可执行文件）
   * 运行：./a.out  ./hello
2. 分步处理（预处理（包含库.i）、编译（汇编.s）、汇编（二进制.o）、链接（可执行文件的链接））

## Makefile

make是一个命令，makefile是一个文件，描述了编译规则。

在大量代码的项目的编译中非常方便。



语法规则

* 目标：依赖文件列表

  <Tab>命令列表

* Makefile等文件名可以被make自动寻找；

* makefile 优点在于可以不用全部编译

### makefile变量

类似于脚本，优点是可以直接修改文件名字





# Part3： 学习Shell和 shell script

# Chapter9-vim程序编辑器

- vim的是用来编辑Linux中的文件的工具。它是所有的类UNIX中都能够使用的编辑器，并且很多软件的编辑接口主动调用的是vi，所以我们需要学习vim
- vim是vi的高级版本，可以使用颜色或者下划线来显示特殊信息。vim是vi的一个优化版本。vi 文件可以进入文本进行编辑——当然需要可读可写的权限。

1. vi的使用：vim的三种模式
   1. 一般命令模式（有的叫做光标模式）：移动、删除、复制黏贴
   2. 编辑模式：按i,o,a等按键可以进入，左下角会显示INSERT，可以对文本进行编辑
   3. 命令行模式：一般模式下输入：？/三个中的任何一个进入，光标会移动到最下方，此时可以输入命令。
   4. Esc回到一般模式，两个模式之间不能够直接变化。
2. 具体的快捷键很多，用多了自然就熟悉了。
3. vim的缓存、恢复和打开时候的警告
4. vim的额外功能：vim相比于vi能够显示颜色，并且右下角显示行号。
   1. 可视区域： 使用V进入，选择一个区域的内容，然后y可以复制，d删除，p粘贴。
   2. 多文件编辑：可以让复制的文字内容在几个不同的文件之中被粘贴。
      1. 用:n和:N切换，用:files来查看编辑的列表；
      2. vi 后面直接跟着多个文件名称就可以打开多个文件同时进行编辑了。
   3. 多窗口功能：：sp[filename]打开，ctrl+w移动光标，移动到某一个窗口之后可以用：q退出
   4. vim的关键词补全功能：ctrl+x打开ctrl+n/f/o进行补全。
5. vim环境设置于记录：vim的文件处理会保存在一个特殊的记录文件中.vimrc和.viminfo，可以进入查看并对文件进行格式的设定。
   1. 使用:set + commad 也可以对vim的配置进行更改
6. 其他的一些问题（具体操作遇到的时候再看书查这一部分就可以了）：
   1. 中文编码：vim使用的编码本身还是跟原来的文件相同的。
   2. DOS和Linux的换行符
   3. 语系编码转换





# Chapter10-BASH

1. BASH是一种Shell，用户通过Shell输入命令与计算机沟通。Shell是操作系统为用户提供的一个界面，其用途就是操控系统（内核、硬件）为用户工作。
   1. 一般来说分为图形化界面和命令行模式

   2. 命令行模式：在远程联机、功能拓展、底层操作上十分有用。

      1. Linux使用的Shell版本为Bash。

   3. BASH的特点：

      1. 历史history（默认可以记录1000条历史命令）
      2. 命令与文件的补全功能
      3. 命令别名设置功能：

      `alias lm='ls -al'`

      1. 任务管理、前后台控制
      2. 程序化脚本
      3. 通配符

   4. 通过`type`命令查询命令是否为bash的内置命令

   5. 命令的执行和快速编辑

2. Shell的变量功能

   1. 变量拓展命令的功能，能够影响bash环境操作、用户更改设定等

   2. 变量的使用和设置

      1. `echo ${变量名}`可以查询和新建一个变量

      2. `变量名=内容`可以赋值，

         1. 等号两侧不能够连接空格。变量名命名遵守江湖规矩

         2. 双引号内符号转义，单引号内符号需要转义字符才能转义，默认情况下所有的符号都是被当作普通字符串处理的

         3. 两个字符可以直接连接比如

            `PATH=${PATH}:/home/bin`可以增加环境变量

   3. `unset NAME`可以取消变量

   4. 环境变量的功能

3. 影响显示结果的语系变量：locale——简单来说就是定义了中英文语系的变啊零

4. 变量的有效范围：进程之间的关系。

5. 变量键盘读取、数组与声明

   1. `read	`
   2. `declare typeset`bash中的变量：默认为字符串,这两个声明是用来
   3. 数组变量类型

6. 与文件系统以及程序的限制关系：`ulimit`

   1. 用来限制用户某些系统资源

7. 变量内容的删除、取代与替换

## 命令别名与历史命令

1. alias和unalias是命令别名
2. 历史命令：history

## BASH shell的操作环境

1. 路径与命令查找顺序
2. bash的登陆与欢迎信息
   1. 存放在了/etc/issue和同目录下的/motd中
3. bash的环境配置文件
   1. bash会在进入的时候直接读取配置文件（profile以及相关的文件），以此来规划好bash的操作环境
4. 终端的环境设置：stty、set
   1. 配置终端的环境，也就是终端中的快捷键、显示之类。
5. 通配符号与特殊符号
   1. 一些符号能够代表一些功能（有点类似正则中的符号），如*代表了0到无穷多个任意字符、？表示了某一个字符等等。
   2. 特殊字符则表明了特殊含义：$是变量前置服啊后，>>可以数据流重定向等等

## 数据流重定向

- 顾名思义，就是将数据引流到其他的地方去（比如打印机，或者某个程序的输入等等）
- 比如一般的命令执行，本质也是由文件之中读入数据，然后处理后从屏幕输出标准错误类型或者从输出设备输出特定的内容。

- 标准输入：代码为0，使用符号`<<或者<`;标准输出：代码为1，`>>或者>`;标准错误输出：代码为2，使用`2>或者2>>`
  - \>是覆盖,\>\>是追写。
  - 简单来说就是把“原本会打印到屏幕”或者“原本需要键盘输入”的内容，用文件的形式输入进去。
- 命令执行的判断根据：； && ||
  - ；用于一次执行多条命令语句
  - $?是前一个命令的逻辑返回值。而&& ||就是命令之间逻辑判断的结果。
    - 命令被正确执行的时候返回0
    - Linux的命令都是从左往右执行

## pipe管道命令

- `command1|command2|command3`管道命令|是将前一个命令的输出作为后一个命令的输入。

1. 选取命令 `cut 、grep`
   1. 前者是切片输出的信息，后者是找到想要的信息提取出来。
2. 排序命令：`sort wc uniq`
   1. 第一个用来排序，第二个删除重复。第三个统计行数和字数。
3. 双重定向`tee`:同时将数据传给文件和屏幕。
4. 字符转换命令:`tr col join paste expand`
   1. 第一个删除和替换、第二个tab转为空格、第三个处理两个文件中相关的部分；第四个粘贴两行内容；expand将tab转为空格
5. 划分命令：`split`
   1. 将大文件划分为小文件
6. 参数代换：`xargs`
7. `-`某些命令在用到文件名的时候。该stdin和stdout可以利用-来替代。





# 正则表达式与文件格式化处理

## 什么是正则表达式

本质上是一种“表示方法”，一般用在匹配特定字符串上。

在shell中扮演基础地位，有着极为广泛的使用，

拓展正则：在基础的规则之上增加的。



## 基础

1. 语系不同对于正则的语法有所不同
2. grep的高级选项（通过正则匹配特定的内容）
3. 基础字符合集
4. sed工具：可以分析标准输入，也可也对数据进行替换、删除、新增、选取等等。

## 拓展正则表达式

拓展匹配的用途是更加方便或者简洁的匹配到特定字符。



## 文件的格式化与相关处理

1. 格式化打印：`printf`
2. 好用的数据处理工具：`awk`
3. 文件对比工具：`diff cmp patch`
4. 文件打印设置：`pr`



## 学习Shell脚本

- 自动化管理计算机的工具，通过文本文件封存命令和语法，规定管道和定向，一次来达到自动管理计算机的目的。
- 除了自动管理之外，跟踪系统、入侵检测、简化流程、简单数据处理等等都很方便的可以实现。

1. 基础的语法规则：第一行#!声明语法规则；单个的#是注释；之后的内容遵守bash的语法，exit 0退出并给出返回值。
2. 通过命令`sh XX.sh`或者`chmod a+x XX.sh;./hello.sh`就可以执行脚本
3. 良好的编写习惯：头处记录好脚本功能、版本信息、作者、说明书等等

## 练习（暂时略过）

1. 交互式脚本
2. 数值计算脚本
3. 差异化执行脚本：`source`命令让脚本可以直接在父进程中执行。



## 善用判断式

存在一些判断，让命令返回逻辑结果，组成更加复杂的逻辑。

## 条件判断式

1. 利用if..then(elif else)..
2. case...esac...
3. 函数function

## loop循环

1. while do done\ until do done
2. for..do ..done
   1. 搭配随机数与数组

## Shell脚本的跟踪与调试



这两节的内容都只是简单介绍，这部分最重要的还是要我们自己在实际操作的过程中去学习的。



## Chapter 12 　　学习Shell Scripts

1. 什么是Shell Script？
